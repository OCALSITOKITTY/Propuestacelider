<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Calendario 2026-2027 CELIDER-08</title>
  <link rel="stylesheet" href="styles.css">
</head>

<body>

  <!-- ================= HEADER ================= -->
  <header class="topbar">
    <div class="container logo-header">

      <div class="logo-title">
        <img src="logo.png" alt="Logo" class="logo">
        <h1>Calendario 2026-2027 CELIDER-08</h1>
      </div>

      <input type="checkbox" id="menuToggle" class="menu-toggle">

      <label for="menuToggle" class="hamburger">
        <span></span>
        <span></span>
        <span></span>
      </label>

      <div class="controls">
        <button id="refreshBtn" class="btn">Actualizar</button>
        <a id="openSheet" class="link" target="_blank" rel="noopener">
          Editar en Google Sheets
        </a>
      </div>

    </div>
  </header>

  <!-- ================= MAIN ================= -->
  <main class="container layout">

    <!-- ===== CALENDARIO ===== -->
    <section id="calendarArea" class="months"></section>

    <!-- ===== SIDEBAR ===== -->
    <aside class="sidebar">
      <h2>Próximos eventos</h2>
      <div id="upcoming"></div>

      <!-- ================= LEYENDA ================= -->
      <div class="legend">
        <h3 class="legend-title">Leyenda de eventos</h3>

        <div class="legend-items">
          <div class="legend-item">
            <span class="legend-dot tag-actividad"></span>
            <span>Actividad</span>
          </div>

          <div class="legend-item">
            <span class="legend-dot tag-visita"></span>
            <span>Visita</span>
          </div>

          <div class="legend-item">
            <span class="legend-dot tag-reunion"></span>
            <span>Reunión</span>
          </div>

          <div class="legend-item">
            <span class="legend-dot tag-evento"></span>
            <span>Evento</span>
          </div>

          <div class="legend-item">
            <span class="legend-dot tag-feriado"></span>
            <span>Feriado</span>
          </div>
        </div>
      </div>
    </aside>

  </main>

  <!-- ================= MODAL ================= -->
  <div id="modal" class="modal" aria-hidden="true">
    <div class="modal-card">
      <button id="modalClose" class="modal-close">✖</button>
      <h3 id="modalTitle"></h3>
      <p id="modalDate" class="muted"></p>
      <p id="modalDesc"></p>
      <img id="modalImg" class="modal-img" alt="">
      <!-- El onclick fuerza abrir la URL en nueva pestaña -->
      <a id="modalPicsBtn" class="pics-access" target="_blank" rel="noopener" onclick="window.open(this.href,'_blank'); return false;">
        Acceder a fotos
      </a>
    </div>
  </div>

  <!-- ================= FOOTER ================= -->
  <footer class="footer">
    <div class="container">
      <small>ODTeam© - Todos los derechos reservados</small>
    </div>
  </footer>

  <!-- ================= SCRIPT ================= -->
  <script>
    const SHEET_ID = "1M6KmCyI9nW21cD2cLER0POZceWOwQTA25n5sRXzjdYg";
    const SHEET_NAME = "calendar";
    const SHEET_URL = `https://opensheet.elk.sh/${SHEET_ID}/${SHEET_NAME}`;
    const YEAR = 2026;

    const months = ["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];
    const daysShort = ["D","L","M","M","J","V","S"];
    const qs = s => document.querySelector(s);

    let EVENTS = [];

    const calendarArea = qs("#calendarArea");
    const upcomingEl = qs("#upcoming");
    const refreshBtn = qs("#refreshBtn");
    const openSheetLink = qs("#openSheet");

    const modal = qs("#modal");
    const modalTitle = qs("#modalTitle");
    const modalDate = qs("#modalDate");
    const modalDesc = qs("#modalDesc");
    const modalImg = qs("#modalImg");
    const modalPicsBtn = qs("#modalPicsBtn");
    const modalClose = qs("#modalClose");

    // Link para abrir Google Sheets
    openSheetLink.href = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/edit#gid=0`;

    function parseSafeDate(str) {
      const [y,m,d] = str.split("-").map(Number);
      return new Date(y, m-1, d, 12);
    }

    async function loadEvents() {
      const res = await fetch(SHEET_URL);
      const data = await res.json();

      EVENTS = data.map(r => ({
        date: r.date?.trim(),
        title: r.title?.trim(),
        description: r.description?.trim(),
        image: r.image?.trim(),
        pictures: r.pictures?.trim(),
        type: (r.type || "evento").toLowerCase().trim()
      })).filter(e => e.date && e.title);

      renderCalendar();
      renderUpcoming();
    }

    function renderCalendar() {
      calendarArea.innerHTML = "";

      for (let m = 0; m < 12; m++) {
        const month = document.createElement("section");
        month.className = "month-card";
        month.id = `month-${m+1}`;
        month.innerHTML = `<h2 class="month-title">${months[m]}</h2>`;

        const grid = document.createElement("div");
        grid.className = "month-grid";

        daysShort.forEach(d => {
          const h = document.createElement("div");
          h.className = "day-header";
          h.textContent = d;
          grid.appendChild(h);
        });

        const firstDay = new Date(YEAR, m, 1).getDay();
        const daysInMonth = new Date(YEAR, m+1, 0).getDate();

        for (let i=0;i<firstDay;i++) grid.appendChild(document.createElement("div"));

        for (let d=1; d<=daysInMonth; d++) {
          const key = `${YEAR}-${String(m+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;
          const ev = EVENTS.find(e => e.date === key);

          const cell = document.createElement("button");
          cell.className = "day-cell";
          cell.innerHTML = `<span>${d}</span>`;

          if (ev) {
            cell.classList.add("has-event", `tag-${ev.type}`);
            cell.onclick = () => openModal(ev);
          }

          grid.appendChild(cell);
        }

        month.appendChild(grid);
        calendarArea.appendChild(month);
      }
    }

    function renderUpcoming() {
      upcomingEl.innerHTML = "";

      EVENTS.slice(0,6).forEach(ev => {
        const card = document.createElement("div");
        card.className = `upcoming-card tag-${ev.type}`;
        card.innerHTML = `<strong>${ev.title}</strong><span>${ev.date}</span>`;
        card.onclick = () => openModal(ev);
        upcomingEl.appendChild(card);
      });
    }

    function openModal(ev) {
      modalTitle.textContent = ev.title;
      modalDate.textContent = ev.date;
      modalDesc.textContent = ev.description;

      modalImg.style.display = ev.image ? "block" : "none";
      modalImg.src = ev.image || "";

      // ✅ Para cualquier enlace de fotos (Drive, galerías, etc.)
      if (ev.pictures) {
        modalPicsBtn.href = ev.pictures;
        modalPicsBtn.style.display = "inline-block";
      } else {
        modalPicsBtn.style.display = "none";
      }

      modal.classList.add("open");
    }

    modalClose.onclick = () => modal.classList.remove("open");
    modal.onclick = e => e.target === modal && modal.classList.remove("open");

    loadEvents();
  </script>

</body>
</html>
